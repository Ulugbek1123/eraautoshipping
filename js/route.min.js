var params=new URLSearchParams(window.location.search);if(params&&params.has("gclid")&&sessionStorage)sessionStorage.setItem("referral","google_ads");else if(params&&params.has("msclkid")&&sessionStorage)sessionStorage.setItem("referral","bing_ads");else if(params&&params.has("utm_source")&&sessionStorage)sessionStorage.setItem("referral",params.get("utm_source"));else if(!sessionStorage.getItem("referral")){var referrer=document.referrer;if(-1!==referrer.indexOf("www.bing.com/aclk"))sessionStorage.setItem("referral","bing_ads");else if(-1!==referrer.indexOf("yahoo.com/cbclk2"))sessionStorage.setItem("referral","yahoo_ads");else if(-1!==referrer.indexOf("aol.com/click"))sessionStorage.setItem("referral","aol_ads");else{var matches=referrer.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i);matches&&matches[1]&&"nexusautotransport.com"!=matches[1]&&sessionStorage.setItem("referral",matches[1])}}const locations={pickup:null,pickup_city:null,pickup_zip:null,delivery:null,delivery_city:null,delivery_zip:null};function markState(t,e){let i=t.split(", "),o=i[i.length-1].toLowerCase();if(o="dic"==o?"dc":o,locations[e]=o,locations[e+"_city"]=i.length>2?i[1]:i[0],locations[e+"_zip"]=i.length>2?i[0]:"",locations.pickup&&locations.delivery){document.querySelectorAll(".route-map__path--selected").forEach(t=>{t.dispatchEvent(new Event("click"))}),document.getElementsByClassName(locations.pickup)[0].dispatchEvent(new Event("click")),document.getElementsByClassName(locations.delivery)[0].dispatchEvent(new Event("click")),fetch(`/actions/nexus/ajax/map/?pickup=${locations.pickup}&delivery=${locations.delivery}`).then(t=>t.json()).then(t=>$(".route-map__summary-distance").first().find("span").text(t.distance+" MI")).then(()=>$(".route-map__summary").first().css("opacity",1))}else document.getElementsByClassName(o)[0].dispatchEvent(new Event("click")),$(".route-map__summary").first().css("opacity",0)}function markStateByCache(t,e){let i=t.split(", "),o=i[i.length-1].toLowerCase();o="dic"==o?"dc":o,locations.pickup=o,locations.pickup_city=i.length>2?i[1]:i[0],locations.pickup_zip=i.length>2?i[0]:"",i=e.split(", ");let s=i[i.length-1].toLowerCase();s="dic"==s?"dc":s,locations.delivery=s,locations.delivery_city=i.length>2?i[1]:i[0],locations.delivery_zip=i.length>2?i[0]:"",fetch(`/actions/nexus/ajax/map/?pickup=${locations.pickup}&delivery=${locations.delivery}`).then(t=>t.json()).then(t=>$(".route-map__summary-distance").first().find("span").text(t.distance+" MI")).then(()=>{document.getElementsByClassName(o)[0].dispatchEvent(new Event("click")),document.getElementsByClassName(s)[0].dispatchEvent(new Event("click")),$(".route-map__summary").first().css("opacity",1)})}function formatDate4Backend(t){if(t){var e=new Date(t),i=""+(e.getMonth()+1),o=""+e.getDate(),s=e.getFullYear();return i.length<2&&(i="0"+i),o.length<2&&(o="0"+o),[s,i,o].join("-")}return null}$(document).ready((function(){const t=$("#route-map").get(0);function e(){$("#size-of-car .size-of-car").val()||setTimeout((function(){$("#size-of-car").trigger("click")}),100)}t&&new RouteMap(t,{api:{endpoint:"/actions/nexus/ajax/map"},cta:{href:"/car-shipping-calculator/"}}),$(".form-group.from").on("click",".list-group-item",(function(){$("#delivery").val()||$("#delivery").focus()})),$(".form-group.to").on("click",".list-group-item",(function(){$("#time .time").val()||setTimeout((function(){$("#time").trigger("click")}),100)})),$("input").keydown((function(t){$(this).hasClass("fill")&&$(this).next(".list-group").has("div").length&&(40==t.which&&($(this).next(".list-group").children().hasClass("hover")?$(this).next(".list-group").children(".hover").removeClass("hover").next().addClass("hover"):$(this).next(".list-group").children().first().addClass("hover")),38==t.which&&($(this).next(".list-group").children().hasClass("hover")?$(this).next(".list-group").children(".hover").removeClass("hover").prev().addClass("hover"):$(this).next(".list-group").children().last().addClass("hover")),t.which)})),$(".location-form__tabs--link").click((function(){if(!$(this).hasClass("active")){$(this).addClass("active");let t=$(this).data("target");$(t).addClass("active"),$(this).siblings().first().removeClass("active"),$(t).siblings().first().removeClass("active")}}));var i=null;$(".address_input").on("input",(function(){$(this).addClass("fill"),$(this).parents(".form-group").first().addClass("fill"),o($(this))})),$(".address_input").on("click",(function(){$(this).addClass("fill"),$(this).parents(".form-group").first().addClass("fill"),s($(this))})),$(".address_input").on("keydown",(function(t){if(13===t.keyCode){t.preventDefault();let e=$(this).context;$(e).siblings(".list-group").children(".hover").length?$(e).siblings(".list-group").children(".hover").click():$(e).siblings(".list-group").children().first().length&&$(e).siblings(".list-group").children().first().click()}}));const o=function(t,e=300){let i;return(...o)=>{clearTimeout(i),i=setTimeout(()=>{t.apply(this,o)},e)}}(t=>s(t),300);function s(t){if(t.val()){i&&i.abort();let e=t.siblings(".list-group");i=$.get(`${window.NEXUS_API_URL}/api/locations?q=${t.val()}`,(function(i){e.html(""),i.data.map((e,i)=>{i<5&&t.hasClass("fill")&&(e.zip?t.siblings(".list-group").append(`<div type="button" class="list-group-item list-group-item-action text-left border-0"><p>${e.zip}, ${e.city}, ${e.state}</p></div>`):t.siblings(".list-group").append(`<div type="button" class="list-group-item list-group-item-action text-left border-0"><p>${e.city}, ${e.state}</p></div>`))})}))}}$(document).click((function(t){if($(".form-group.fill").length){let e=$(t.target).parents(".list-group").first().siblings(".address_input").first();$(t.target).hasClass("list-group-item")||$(t.target).parent("div").first().hasClass("list-group-item")?(e.attr("data-selected",$(t.target).text()),e.val($(t.target).text()),markState($(t.target).text(),e.attr("name")),$(t.target).parents(".list-group").html("")):($("input.fill").val(""),$("input.fill").attr("data-selected",""),$(".list-group").html("")),$(".address_input").each((function(){$(this).removeClass("fill"),$(this).parents(".form-group").first().removeClass("fill")}))}})),$(".calculator .cstep-1 input.time").each((function(t,i){$(i).datepicker({showAnim:"slideDown",duration:250,minDate:0,showOn:"none",onSelect:function(t,i){$(this).val();setTimeout((function(){$(this).closest(".dropdown").removeClass("show"),e()}),250)},onClose:function(t,e){$(this).val();var i=$(this);setTimeout((function(){i.closest(".dropdown").removeClass("show")}),250)}})})),$(".calculator .cstep-1 .dropdown-toggle").on("click",(function(t){t.stopPropagation(),t.preventDefault();var e=$(this);$(".calculator .cstep-1 .dropdown-toggle").not(e).closest(".dropdown").find(".dropdown-menu:visible").stop(!0,!0).slideUp(250,(function(){$(window).width()<768?$(this).closest(".dropdown").find(".popup-bg").fadeOut(250,(function(){$(this).closest(".dropdown").removeClass("show")})):$(this).closest(".dropdown").removeClass("show")}));var i=e.closest(".dropdown");i.hasClass("show")?i.find(".dropdown-menu").first().stop(!0,!0).slideUp(250,(function(){$(window).width()<768?i.find(".popup-bg").fadeOut(250,(function(){i.removeClass("show")})):i.removeClass("show")})):i.find(".dropdown-menu").first().find(".dropdown-item").length>0&&(i.addClass("show"),i.find(".popup-bg").fadeIn(250),i.find(".dropdown-menu").first().stop(!0,!0).slideDown(250))})),$(".calculator .dropdown .dropdown-item").on("click",(function(t){var i=$(this).closest(".dropdown"),o=$(this);if(o.is(".datepicker-item")&&t.stopPropagation(),o.is(".more-vehicle"))return t.stopPropagation(),o.hide(),o.siblings(".dropdown-item:hidden").fadeIn(100),!1;o.parents(".form-group.time")&&0==o.parents(".form-group.vehicle").length&&!o.is(".datepicker-item")&&e(),i.find(".dropdown-menu").first().stop(!0,!0).slideUp(250,(function(){o.is(".datepicker-item")?(i.find("input.time").datepicker("widget").insertAfter(i.find(".dropdown-menu").first()),i.find("input.time").datepicker("show")):$(window).width()<768?i.find(".popup-bg").fadeOut(250,(function(){i.removeClass("show")})):i.removeClass("show")}))})),$(document).on("click",(function(t){$(t.target).is(".dropdown-toggle")||$(".dropdown-menu:visible").stop(!0,!0).slideUp(250,(function(){$(window).width()<768?$(this).closest(".popup-bg").fadeOut(250,(function(){$(this).closest(".dropdown").removeClass("show")})):$(this).closest(".dropdown").removeClass("show")}))})),$(".calculator .dropdown.act-as-combobox .dropdown-menu").bind("click",(function(t){if(0==$(t.target).is(".dropdown-item")||$(t.target).is(".datepicker-item"))return;const e=$(t.target);let i=e.attr("data-key"),o=e.contents().filter((function(){return this.nodeType==Node.TEXT_NODE})).text().trim();null!=o&&null!=o&&""!=o||(o=e.children().contents().filter((function(){return this.nodeType==Node.TEXT_NODE})).text().trim());let s=e.closest(".dropdown").find("input").first();s.val(o),s.attr("data-key",i),s.trigger("keyup")})),$(".calculator .cstep-1 .dropdown.size-of-car .dropdown-item").not(".more-vehicle").bind("click",(function(){$(this).siblings(".dropdown-item.selected").removeClass("selected"),$(this).addClass("selected")})),jQuery("img.svg").each((function(){var t=jQuery(this),e=t.attr("id"),i=t.attr("class"),o=t.attr("src");jQuery.get(o,(function(o){var s=jQuery(o).find("svg");void 0!==e&&(s=s.attr("id",e)),void 0!==i&&(s=s.attr("class",i+" replaced-svg")),s=s.removeAttr("xmlns:a"),t.replaceWith(s)}),"xml")})),$(window).on("resize",(function(){var t=$(".calculator .cstep-1 .dropdown.time, .calculator .cstep-1 .dropdown.size-of-car").find(".dropdown-menu"),e=t.parent(".popup-bg");$(window).width()<768?0==e.length&&(t.wrap('<div class="popup-bg"></div>'),$(".calculator .dropdown .popup-bg").prepend('<div class="btn-close" />')):($(".calculator .dropdown .popup-bg .btn-close").remove(),0!=e.length&&t.unwrap())})),$(window).trigger("resize"),$(".calculator .popup-bg").bind("click",(function(t){return t.stopPropagation(),t.preventDefault(),!1})),$(".calculator .popup-bg .btn-close").bind("click",(function(){$(document).trigger("click")})),$(".modal-toggle").click((function(t){$($(this).data("target")).toggleClass("shown")})),$(".select-route").submit((function(t){t.preventDefault();let e=$("input[name='time']").val(),i=null;"As soon as possible"!=e&&"Within 7 days"!=e&&"I don't know yet"!=e&&(i=e,e="On a particular date");let o={url:window.NEXUS_API_URL+"/api/web/calculator",method:"POST",timeout:0,headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},data:{pickup_address:$("input[name='pickup']").val(),delivery_address:$("input[name='delivery']").val(),pickup_time:e,vehicle_type:$("input[name='vehicle']").attr("data-key"),pickup_date:formatDate4Backend(i),referral:sessionStorage.getItem("referral")||""}};$.ajax(o).done((function(t){console.log(t);let e={id:t.data.result.calculation_id,from:locations.pickup,from_city:locations.pickup_city,from_zip:locations.pickup_zip??"",to:locations.delivery,to_city:locations.delivery_city,to_zip:locations.delivery_zip??"",move_date:t.data.query.pickup_date||t.data.query.pickup_time,vehicle:$("input[name='vehicle']").val(),quote:{...t.data.result.quote},referral:sessionStorage.getItem("referral")||""};localStorage.setItem("calculation",JSON.stringify(e)),"/"===window.location.pathname?window.location.assign("./calculator/reserve/"):window.location.assign("/calculator/reserve/")})).fail((function(t,e){alertify.alert("Error","Error calculating route, please call us 224-218-2949"),errorCallback&&errorCallback()}))}));var a=!1;if(localStorage.getItem("calculation")&&("/"==window.location.pathname||"/car-shipping-calculator/"==window.location.pathname)&&!a){a=!0;let t=JSON.parse(localStorage.getItem("calculation")),e=t.from_zip?t.from_zip+", ":"";e+=t.from_city.replace(/\w\S*/g,(function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})),e+=", "+t.from.toUpperCase();let i=t.to_zip?t.to_zip+", ":"";if(i+=t.to_city.replace(/\w\S*/g,(function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})),i+=", "+t.to.toUpperCase(),$("input#pickup").attr("data-selected",e),$("input#pickup").val(e),$("input#pickup").text(e),$("input#delivery").attr("data-selected",i),$("input#delivery").val(i),$("input#delivery").text(i),markStateByCache(e,i),"Invalid Date"!=new Date(t.move_date)){let e=t.move_date.split("-");$("input[name='time']").val(`${e[1]}/${e[2]}/${e[0]}`)}else $("input[name='time']").val(t.move_date);let o=$("a.dropdown-item[data-key='"+t.vehicle.toLowerCase()+"']").first();$("input[name='vehicle']").attr("data-key",o.attr("data-key")),$("input[name='vehicle']").val(o.find("span").first().text()),$("input[name='vehicle']").text(o.find("span").first().text())}}));